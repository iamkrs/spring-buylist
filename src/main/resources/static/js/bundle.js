"use strict";function isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}function _construct(e,t,n){return(_construct=isNativeReflectConstruct()?Reflect.construct:function(e,t,n){var r=[null];r.push.apply(r,t);var o=new(Function.bind.apply(e,r));return n&&_setPrototypeOf(o,n.prototype),o}).apply(null,arguments)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function _iterableToArray(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}!function(c){c(function(){window.vm={},vm.items=ko.observableArray(),vm.doneItems=ko.observableArray(),vm.updateDelay=ko.observable(1e3),vm.Item=function(e,t,n,r){var o=this,a=vm.items().map(function(e){return e.id()}).sort(),i=parseInt(a[a.length-1]),u={rateLimit:vm.updateDelay()};o.id=ko.observable(e?parseInt(e):a.length?i+1:1),o.name=ko.observable(e?t:"").extend(u),o.name.subscribe(function(){return o.$ajaxPost()}),o.done=ko.computed(function(){return!!vm.doneItems().find(function(e){return e==o.id()})}),o.done.subscribe(function(){return o.$ajaxPost()}),o.createdAt=ko.observable(r),o.isAjax=ko.observable(!1),o.isInputFocus=ko.observable(!1),o.isRemoveFocus=ko.observable(!1),o.$remove=function(e,t){t&&t.target&&t.preventDefault();var n=o.id();vm.items.remove(vm.items().find(function(e){return e.id()==n})),vm.doneItems.remove(n)},o.index=ko.computed(function(){return vm.items().findIndex(function(e){return e==o})}),o.$focusNext=function(){var e=o.index();c(".listWrapper .item").eq(e+1).find(".nameWrapper input").focus()},o.$ajaxPost=function(){c.ajax({type:"POST",url:"/item",data:{id:o.id(),name:o.name(),createdAt:o.createdAt(),done:o.done()},dataType:"JSON"})},o.$ajaxDelete=function(e,t){t&&t.target&&t.preventDefault(),c.ajax({type:"DELETE",url:"/item/".concat(o.id()),success:function(){return o.$remove()},dataType:"JSON"})},o.event={},o.event.inputKeyup=function(e,t){var n=vm.items()[vm.items().length-1];String(e.name()).length||e==n||o.isInputFocus()||o.$ajaxDelete(),String(n.name()).length&&vm.newItem(),t&&t.which&&13==t.which&&o.$focusNext()},o.event.inputBlur=function(e,t){var n=vm.items()[vm.items().length-1];String(e.name()).length||n==e||o.$ajaxDelete(),setTimeout(function(){return!!o.isRemoveFocus()&&o.$focusNext()},0)}},vm.newItem=function(){var e=vm.items()[vm.items().length-1];e&&!e.name().length||vm.items.push(new vm.Item(!1,"",!1,(new Date).getTime()))},c.ajax("/items").done(function(e){e.sort(function(e,t){return parseInt(e.createdAt)>parseInt(t.created)?1:parseInt(e.createdAt)<parseInt(t.createdAt)?-1:0}),vm.doneItems(e.filter(function(e){return"true"==e.done}).map(function(e){return parseInt(e.id)})),vm.items(e.map(function(e){return _construct(vm.Item,_toConsumableArray(Object.values(e)))})),vm.newItem()}),ko.applyBindings(vm)})}(jQuery);